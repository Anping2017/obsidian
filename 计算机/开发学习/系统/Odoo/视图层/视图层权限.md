核心结论先说在前：**菜单/视图只是“看得见与交互方式”的控制，不是安全边界**；真正的安全要靠 **ACL + Record Rules**



---

# 视图层权限（Views & Fields）

## 1) 在视图/字段上用 groups 精准控制

### 视图级（整块视图只对某组可见/生效）

```xml
<record id="view_order_form_mgr" model="ir.ui.view">
  <field name="name">my.order.form.manager</field>
  <field name="model">my.device.order</field>
  <field name="inherit_id" ref="your_module.view_order_form_base"/>
  # 增加这段
  <field name="groups_id" eval="[(6,0,[ref('your_module.group_my_manager')])]"/> 
  <field name="arch" type="xml">
    <xpath expr="//sheet" position="inside">
      <group string="Manager Tools">
        <field name="profit_margin"/>
        <button name="action_force_done" type="object" string="Force Done"/>
      </group>
    </xpath>
  </field>
</record>

```


### 字段/按钮级（针对组显示/隐藏）
```xml
<!-- 仅经理可见 -->
<field name="profit_margin" groups="your_module.group_my_manager"/>

<!-- 按钮仅经理可见 -->
<button name="action_force_done" type="object" string="Force Done"
        groups="your_module.group_my_manager"/>

```


## 2) 字段级只读/隐藏：attrs + groups（UI 控制）
```xml
<!-- 草稿可编辑；非草稿只读 -->
<field name="name" attrs="{'readonly':[('state','!=','draft')]}"/>

<!-- 普通用户看只读；经理可编辑（用两段 view 叠加更清晰） -->
<field name="amount_total"
       attrs="{'readonly': True}"
       groups="your_module.group_my_user"/>
<field name="amount_total"
       attrs="{'readonly': False}"
       groups="your_module.group_my_manager"/>

```

- `attrs` 是 **客户端**控制，用户通过 API 仍可能写入 → **不要当成安全手段**。有安全诉求，务必用 **ACL/Record Rules/约束**。
    

## 3) 动态 `domain`（前端筛选，不是安全）

**字段可选项限制：**

```
<field name="user_id"
       domain="[('groups_id','in',[ref('sales_team.group_sale_salesman')])]"/>

```

**动作默认过滤 / 搜索默认：**
```
<record id="action_my_orders" model="ir.actions.act_window">
  <field name="name">Orders</field>
  <field name="res_model">my.device.order</field>
  <field name="view_mode">tree,form"
  />
  <field name="domain">[('company_id','in', company_ids)]</field>
  <field name="context">{'search_default_my_records': 1}</field>
</record>

<!-- 搜索视图：给一个“只看我的”快捷筛选 -->
<record id="view_my_order_search" model="ir.ui.view">
  <field name="name">my.order.search</field>
  <field name="model">my.device.order</field>
  <field name="arch" type="xml">
    <search>
      <filter name="my_records" string="My Records"
              domain="[('user_id','=', uid)]"/>
    </search>
  </field>
</record>

```


> 这些只影响 UI 默认表现；**安全隔离必须在记录规则**里写同样的 domain（如公司隔离）。

---

# ✅ Odoo 17 实战建议（精要）

1. **菜单 + 动作都设 groups**：避免直链访问。
    
2. **UI ≠ 安全**：`groups`/`attrs`/`domain` 只控前端；**ACL 决定能否 CRUD**，**Record Rules 决定可见哪些记录**。
    
3. **多公司统一隔离**：全局记录规则加  
    `['|', ('company_id','=',False), ('company_id','in', company_ids)]`
    
4. **经理特权**：用“经理专属覆盖视图 + 放宽的分组记录规则”；仍受全局公司规则约束。
    
5. **按钮提权慎用**：避免随手 `sudo()`；确需提权时在服务端再做业务校验。