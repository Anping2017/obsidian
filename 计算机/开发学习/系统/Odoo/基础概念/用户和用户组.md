
- **用户 (Users)** → 每个账号就是一个用户。
    
- **用户组 (Groups)** → 权限是分配给组的，不直接分配给用户。
    
- 用户可以属于多个组 → 权限叠加。
    
- 常见的层级：
    
    - Public User（匿名用户）
        
    - Portal User（外部客户）
        
    - Internal User（公司员工）


## 1. 用户和 res.partner 的关系

- 在 Odoo 中，**用户（res.users）** 和 **伙伴（res.partner）** 是紧密关联的：
    
    - 每一个用户账号，都会对应一条 **伙伴记录**（partner_id）。
        
    - 用户是登录系统的入口，伙伴是业务实体（客户、供应商、员工等）。
        
    - 用户创建后，系统会自动生成对应的 partner。
        
- 举例：
    
    - “张三”是一个客户（partner）。
        
    - 如果你需要让张三登录门户网站 → 给他分配一个用户（user），绑定该 partner



## 2. 用户的登录账号与邮箱绑定

- 用户表（res.users）有一个 **login** 字段 → 登录用户名/邮箱。
    
- 通常，Odoo 默认用邮箱作为登录名。
    
- 用户表和伙伴表的邮箱字段可以保持一致，也可以分开（但一般推荐保持一致，方便识别）。
    
- 当用户登录时，系统验证：
    
    1. login（用户名/邮箱）是否存在；
        
    2. password 是否正确；
        
    3. 账号是否启用（active 字段）。


## 3. 内部用户 vs 门户用户 vs 公共用户

Odoo 里常见的三类用户角色：

### 🔹 内部用户（Internal User）

- 属于公司员工，正常进入后台系统。
    
- 有完整的模块访问权限，可以通过用户组分配权限。
    
- 典型场景：销售人员、会计、仓库管理员。
    

### 🔹 门户用户（Portal User）

- 面向客户/供应商（外部用户）。
    
- 只能访问与自己相关的记录，比如：
    
    - 客户 → 仅能看到自己的销售订单、发票。
        
    - 供应商 → 仅能看到和自己相关的采购订单。
        
- 常用于 **B2B/B2C 客户门户**。
    

### 🔹 公共用户（Public User）

- 系统内置的匿名用户，ID 固定为 `base.public_user`。
    
- 所有人在未登录状态访问网站时，都是 public user。
    
- 权限非常有限，一般只允许浏览网站、提交联系表单。
    
- 常用于电商网站的访客浏览。



# 二、用户与用户组（Users & Groups）

## 1. 用户（res.users）

### 1.1 用户类型（内部、门户、公共）

- **内部用户（Internal User）**
    
    - 属于公司员工，有后台访问权限。
        
    - 通过分配用户组（groups）来控制能访问哪些模块（销售、库存、财务等）。
        
- **门户用户（Portal User）**
    
    - 面向客户或供应商，只能看到与自己相关的记录。
        
    - 例如：客户登录后只能看到自己的订单/发票，而看不到别人的。
        
- **公共用户（Public User）**
    
    - 系统内置匿名账号（base.public_user）。
        
    - 未登录时访问网站的访客默认使用此用户，权限极低。
        

---

### 1.2 用户配置与公司（Multi-company）

- 用户可以属于一个或多个公司：
    
    - **主公司（company_id）**：用户的默认公司。
        
    - **允许公司（company_ids）**：用户可以切换的公司集合。
        
- 切换公司后，数据访问会受到 `company_id` 字段和 record rules 限制。
    
- 常见场景：
    
    - 总部财务人员可访问多公司数据。
        
    - 普通员工只能看到自己所在公司的数据。
        

---

## 2. 用户组（res.groups）

### 2.1 用户组的继承关系

- 用户组之间可以继承：
    
    - 父组的权限会自动传递到子组。
        
    - 典型例子：
        
        - “销售经理”组继承“销售员”组 → 销售经理拥有销售员的全部权限 + 额外权限。
            

### 2.2 用户组在 UI 的表现（多选项切换权限）

- 在用户界面，某些权限以“单选/多选”形式出现，其实背后就是 **互斥组（implied_ids/exclusive groups）** 的配置。
    
    - 例如：销售 → 用户角色（销售员 / 销售经理）。
        
    - 用户只能选一个，因为这些组是互斥关系。
        

### 2.3 隐藏/显示菜单依赖 groups

- 在 XML 中定义菜单或视图时，可以加上 `groups="module.group_xxx"`：
    
    - 只有该组的用户能看到对应菜单。
        
    - 没有权限的用户，菜单不会显示。



## 3. 组与权限的关系

### 3.1 模型访问权限分配（Access Control）

- ACL（ir.model.access.csv）文件定义每个组在模型上的权限：
    
    - 读（Read）、写（Write）、创建（Create）、删除（Delete）。
        
- 例如：
    
    - 普通销售员：销售订单（sale.order）只读。
        
    - 销售经理：销售订单可读写删。
        

### 3.2 字段 domain 与组的结合使用

- 在字段或视图上可以结合组来限制 domain：
    
    - 例如：
        
        `<field name="user_id" domain="[('groups_id','in',[ref('sales_team.group_sale_salesman')])]" />`
        
    - 让销售员只能选择本组内的人作为负责人。
        

### 3.3 record rules 与组的绑定

- record rules（ir.rule）可以与用户组绑定：
    
    - 定义用户能访问哪些数据记录。
        
    - 例子：
        
        - 销售员只能访问自己创建的订单：
            
            `[('user_id', '=', user.id)]`
            
        - 销售经理能访问所有订单 → 绑定经理组，无 domain 限制。