# Odoo ORM：数据库交互的核心
Odoo的ORM（Object-Relational Mapping）是开发者与PostgreSQL数据库交互的核心，它用Python代码抽象了复杂的SQL查询 。这种抽象不仅简化了开发，更内置了对SQL注入的防护，通过高级API避免手动执行原始SQL查询，从而确保了数据操作的安全性 。  

Odoo ORM提供了多种核心方法来简化数据操作：

- **创建记录**：使用[[Model.create(vals_list)]]方法，它接受一个字典列表作为参数，用于创建新的数据库记录 。  
    
- **读取记录**：[[Model.read(_fields_)]]和[[Model.browse(_ids_)]]用于检索数据，`read()`返回字段值的字典列表，而`browse()`返回一个记录集，允许通过属性访问字段 。  
    
- **更新记录**：[[Model.write(vals)]]方法用于更新现有记录，它接受一个包含要更新的字段及其新值的字典 。  
    
- **删除记录**：[[Model.unlink()]]方法用于从数据库中永久删除记录 。  
    
- **搜索记录**：[[Model.search(_domain, limit=None, order=None)]]方法根据给定的条件搜索记录并返回匹配的记录集 。  
    

高级开发者需要超越基本CRUD操作，理解不同查询方法的性能差异。

`search()`返回的是记录ID列表，如果之后需要遍历并读取每个记录的字段，会产生大量独立的`read()`查询，这正是经典的“N+1”查询问题 。Odoo为了解决这一问题，提供了更高效的查询方法。  

`search_read()`方法将`search()`和`read()`操作结合在一次数据库调用中完成，显著减少了数据库往返次数，提高了数据检索效率 。此外，  

`read_group()`方法专为数据聚合设计，它将分组、求和、计数等逻辑下推到数据库层面执行，而不是在Python代码中处理大量数据。这对于生成报表和仪表盘数据至关重要，能够极大提升性能 。  

下表对比了Odoo常用ORM查询方法在性能、数据库调用和适用场景上的差异：

|查询方法|描述|数据库调用|适用场景|
|---|---|---|---|
|`search()` + `read()`|先搜索记录ID，再逐个读取字段|N+1 次查询|简单操作，数据量小或需要复杂后处理|
|`search_read()`|一次性搜索并读取指定字段|1 次查询|提高列表视图和仪表盘性能|
|`read_group()`|将分组和聚合逻辑推送到数据库执行|1 次查询|复杂报表、数据聚合分析|


通过关系字段进行多级数据查询同样是ORM的高级应用。Odoo的ORM提供了**预取（pre-fetching）机制**，可以在一次数据库查询中获取相关联的记录，从而避免多次往返 。此外，  

`mapped()`方法能够以简洁高效的方式获取关系链上的所有字段值，甚至返回一个包含不重复记录的新记录集 。例如，  

`records.mapped('partner_id.bank_ids')` 可以高效地返回所有相关合伙人的银行账户记录，并且自动去重，这大大简化了复杂数据结构的遍历和处理。