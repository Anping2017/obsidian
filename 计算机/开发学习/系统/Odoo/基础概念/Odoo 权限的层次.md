## 1. 权限的四个层次

![[Pasted image 20250924135807.png]]


Odoo 的权限控制是 **逐层过滤** 的，每一层都可能限制用户的操作：

1. **菜单权限 (Menu / Action)**
    
    - 决定用户能不能看到某个模块或菜单。
        
    - 通过 **groups** 限制。
        
    - 例：普通员工看不到“会计”菜单。
        
2. **模型权限 (Access Rights / ir.model.access.csv)**
    
    - 针对整个模型设置 **CRUD** 权限：
        
        - Create（新建）
            
        - Read（读取）
            
        - Write（编辑）
            
        - Delete（删除）
            
    - 属于**静态权限**，定义在 `ir.model.access.csv` 文件中。
        
3. **记录规则 (Record Rules / ir.rule)**
    
    - 针对 **某个模型的数据记录** 进行过滤。
        
    - 使用 **domain** 条件，比如：`[('user_id', '=', user.id)]`。
        
    - 例：销售只能看到自己订单，经理能看到全部订单。
        
4. **字段级权限 (Field-level security)**
    
    - 在视图 XML 中通过 `groups="group_xxx"` 控制字段是否显示。
        
    - 或者通过 `attrs` 设置字段只读/隐藏。
        
    - 例：订单中的“利润”字段只有经理能看到。


## 2. 权限检查顺序

当用户尝试访问某个数据时，Odoo 会按顺序做检查：

1. **模型访问权限 (Access Rights)** → 是否允许 CRUD 操作
    
2. **记录规则 (Record Rules)** → 用户是否能访问这条记录
    
3. **字段权限 (Groups / attrs)** → 前端界面是否可见或可编辑
    

⚠️ 注意：**菜单权限只影响显示**，即使隐藏菜单，如果用户有 URL 或 API 入口，依然能访问 → 所以必须在 **模型权限/记录规则** 上做严格控制。



## 核心控制

**双重权限管理体系** Odoo的权限管理由两个层次构成，提供了高度的灵活性和细粒度控制 ：  

- **访问权限（Access Rights）**：这是第一层权限，基于用户组来控制对模型的CRUD（创建、读取、更新、删除）操作 。例如，一个用户组可能被授予对  
    
    `sale.order`模型的读取和创建权限。
    
- **记录规则（Record Rules）**：这是第二层权限，用于在行级别（row-level）上进一步筛选数据 。通过为模型定义一个“域”（Domain），可以限制用户只能看到或操作满足特定条件的记录 。这种双层权限机制是企业级ERP系统的核心需求。例如，一个销售经理需要查看其团队的所有销售订单，而一个普通销售人员只能查看自己的订单。在这种情况下，  
    
    `访问权限`可以授予两种用户对`sale.order`模型的`读取`权限，但`记录规则`会为普通销售人员添加一个域过滤器，如`[('user_id', '=', user.id)]`，从而实现了对数据的动态、行级控制 。  



## 3. 简单例子

假设有一个 **销售订单模型 (sale.order)**：

- 菜单：销售员工能看到“销售”菜单，Portal 用户看不到。
    
- 模型权限：
    
    - 销售员工组 → 读/写/创建
        
    - 财务组 → 读/写，不允许创建/删除
        
- 记录规则：
    
    - 销售只能看到自己创建的订单
        
    - 经理能看到全部订单
        
- 字段权限：
    
    - “利润”字段只有经理能看到
        
    - “折扣”字段普通销售可见但不可修改