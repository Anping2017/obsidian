在 Odoo 中，服务器动作 (`ir.actions.server`) 是一种非常强大的自动化工具，它允许你在不编写 Python 代码的情况下，通过界面配置来执行一系列预定义的服务器端操作。这些操作可以从按钮、菜单项、计划任务或特定模型上的上下文动作中触发。

服务器动作是 Odoo 灵活性的一个关键组成部分，它将业务逻辑的配置从代码中分离出来，使得非开发者也能实现简单的自动化流程。

---

#### 核心功能与应用场景

`ir.actions.server` 的核心是其**“执行类型”（`action_type`）**，它决定了动作被触发时将执行什么样的操作。常见的执行类型包括：

1. **执行 Python 代码 (`code`)**:
    
    - **功能**：这是最强大的类型，允许你直接编写 Python 代码来操作记录集或执行任何 Odoo API 支持的逻辑。
        
    - **应用场景**：批量更新字段、创建新的记录、发送电子邮件、调用外部 API 等。
        
    - **使用方式**：你可以在一个文本区域中编写 Python 代码，通常会提供一个 `self` 变量，它代表当前操作的记录集。例如，`self.write({'state': 'done'})` 可以将选中记录的状态批量更新为“已完成”。
        
2. **创建新记录 (`object_create`)**:
    
    - **功能**：根据配置，自动创建一个新记录。
        
    - **应用场景**：在创建销售订单时自动创建一个任务；在某个流程的特定阶段自动生成一个工单。
        
    - **使用方式**：你需要指定要创建记录的模型，以及新记录的默认值。
        
3. **更新记录 (`object_write`)**:
    
    - **功能**：批量更新现有记录的字段值。
        
    - **应用场景**：将所有处于“草稿”状态的销售订单更新为“已确认”；批量修改客户的某个标签。
        
4. **执行一个动作 (`action_exec`)**:
    
    - **功能**：触发另一个已存在的 Odoo 动作，例如窗口动作 (`ir.actions.act_window`)、报告动作或另一个服务器动作。
        
    - **应用场景**：在一个复杂的流程中，执行完服务器端逻辑后，自动跳转到一个新的界面视图或打印一个报告。
        
5. **发送电子邮件 (`email`)**:
    
    - **功能**：使用 Odoo 的邮件模板发送邮件。
        
    - **应用场景**：在销售订单确认后自动向客户发送一封确认邮件；在任务完成时通知相关负责人。
        
6. **调用外部 API (`url_call`)**:
    
    - **功能**：向指定的 URL 发送 HTTP 请求，从而调用外部服务。
        
    - **应用场景**：将 Odoo 的数据同步到外部 CRM 系统；从外部服务获取实时汇率数据。
        

---

#### 配置与使用

创建和配置服务器动作通常涉及以下几个步骤：

1. **导航到开发者模式**：确保你已启用开发者模式。
    
2. **创建服务器动作**：
    
    - 进入 **设置 -> 技术 -> 自动化 -> 服务器动作**。
        
    - 点击“创建”按钮。
        
3. **配置基本信息**：
    
    - **动作名称 (`name`)**：描述这个动作的用途，例如“批量更新销售订单状态”。
        
    - **应用模型 (`model_id`)**：指定这个动作将作用于哪个模型，例如 `sale.order`。
        
    - **动作类型 (`action_type`)**：选择你想要执行的操作类型，如“执行 Python 代码”。
        
4. **配置触发方式**：
    
    - **上下文动作 (`Binding Model`)**：
        
        - 最常见的方式。你可以在模型视图（如列表视图或表单视图）中，选中一个或多个记录，然后在“动作”菜单中找到并执行这个服务器动作。
            
    - **菜单项 (`Menu Entry`)**：
        
        - 将服务器动作配置为一个菜单项，用户点击菜单即可执行。
            
    - **计划任务 (`Scheduled Action`)**：
        
        - 将服务器动作设置为一个定期执行的计划任务，例如每天凌晨执行一次数据清理。
            

---

#### 示例：一个简单的服务器动作

假设你想创建一个服务器动作，当用户在销售订单上点击一个按钮时，自动生成一个与该订单相关联的采购订单。

1. **创建服务器动作**:
    
    - **名称**: “生成采购订单”
        
    - **应用模型**: `sale.order`
        
    - **动作类型**: `执行 Python 代码`
        
    - **Python 代码**:
        
        Python
        
        ```
        # self 代表当前选中的 sale.order 记录集
        for order in self:
            # 在这里编写生成采购订单的逻辑
            purchase_order = self.env['purchase.order'].create({
                'partner_id': order.partner_id.id,
                'sale_order_id': order.id,
                'order_line': [(0, 0, {
                    'product_id': line.product_id.id,
                    'product_qty': line.product_uom_qty,
                    'product_uom': line.product_uom.id,
                    'price_unit': line.price_unit,
                }) for line in order.order_line]
            })
            # 可以在这里添加一些通知
            order.message_post(body=f"已自动生成采购订单: {purchase_order.name}")
        ```
        
2. **配置上下文动作**:
    
    - 在服务器动作的 `上下文动作` 标签页中，你可以配置它在哪个模型上显示为一个动作按钮。
        
    - **模型**：`sale.order`
        
    - **绑定类型**：`上下文操作` (或 `动作`)
        
    - **绑定模型**：`sale.order`
        

完成配置后，当你进入销售订单的列表视图或表单视图，并在“动作”下拉菜单中，你就会看到“生成采购订单”这个选项，点击即可执行上述 Python 逻辑。

服务器动作是 Odoo 无代码或低代码开发理念的体现，它允许业务分析师和实施顾问快速实现复杂的业务流程自动化，而无需依赖于传统的代码开发和部署流程。